package com.example.demo.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.example.demo.domain.LoginDto;
import com.example.demo.domain.UserDto;
import com.example.demo.repository.UserRepository;
import com.example.demo.util.TokenProvider;

@RestController
@RequestMapping("/api")
public class JwtTestController {
	
	@Autowired
	private UserRepository repository;
	
	@Autowired
	private TokenProvider tokenProvider;
	
	@GetMapping("/test")
	public ResponseEntity<String> test(LoginDto params, HttpServletRequest request, HttpServletResponse response){
		System.out.println(params);
		
		  String token = null; 
		  UserDto loginUser = repository.findUser(params);
		  if(loginUser == null) { return null; }
		  else {
			  System.out.println(loginUser);
			  token = tokenProvider.createToken(loginUser); 
			  System.out.println("토큰: " + token);
			  response.setHeader("authorization", token);	 
			  System.out.println("토큰으로 부터 불러온 아이디: " +  tokenProvider.getUsernameFromToken(token));
			  System.out.println("토큰으로 부터 불러온 롤: " +  tokenProvider.getRolesFromToken(token));
		  }
		  
//		  return ResponseEntity.ok((String)tokenProvider.getUsernameFromToken(token));
		  return ResponseEntity.ok("test");
	}
}
